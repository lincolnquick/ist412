<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buffett Inc. HRMS Messages</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <style type="text/css">
        .Payroll {
        }
    </style>
</head>
<body>
<div class="container">
    <ul class="nav nav-tabs">
        <li class="nav-item"><a class="nav-link" th:href="@{/}">Home</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/employees/list}">Employees</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/payroll/payroll}">Payroll</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/ptobalance/pto}">Paid Time Off</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/timesheets/timesheets}">Time Sheets</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/training/training}">Training</a></li>
        <li class="nav-item"><a class="nav-link active" th:href="@{/messages/messages}">Messages</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/notifications/notifications}">Notifications</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/tasks/tasks}">Tasks</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/payments/paystubs}">Paystubs</a></li>
    </ul>
</div>
<div class="container">

    <h1 class="mt-5">Buffett Inc. HRMS Messages</h1>

    <h2 class="mt-5">Select an Employee</h2>
    <select id="employeeSelect" name="employeeSelect" class="form-control mb-3">
        <option th:each="employee : ${employees}" th:value="${employee.employeeID}" th:text="${employee.firstName + ' ' + employee.lastName}"></option>
    </select>

    <table id="messagesTable" class="table">
        <thead>
        <tr>
            <th scope="col">Sender</th>
            <th scope="col">Title</th>
            <th scope="col">Date</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="message : ${messages}">
            <td th:text="${message.sender.firstName + ' ' + message.sender.lastName}"></td>
            <td th:text="${message.title}"></td>
            <td th:text="${message.timestamp}"></td>
            <td>
                <a th:href="@{/messages/view/{messageID}(messageID=${message.messageID})}" class="btn btn-info">View</a>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Compose message button -->
    <form id="composeForm" action="/messages/compose" method="get">
        <input type="hidden" name="senderID" th:value="${selectedEmployeeId}">
        <button type="submit" class="btn btn-primary">Compose Message</button>
    </form>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        $("#employeeSelect").change(function() {
            var employeeID = $(this).val();

            $.ajax({
                url: '/messages/received/' + employeeID,
                type: 'GET',
                success: function(data) {
                    // Clear the table
                    $("#messagesTable tbody").empty();

                    // Iterate over each message
                    $.each(data, function(i, message) {
                        // Append a new row to the table for each message
                        $("#messagesTable tbody").append(
                            '<tr>' +
                            '<td>' + message.title + '</td>' +
                            '<td>' + message.sender.name + '</td>' +
                            '<td>' + message.recipient.name + '</td>' +
                            '</tr>'
                        );
                    });

                    // Update the form action URL with the senderID
                    var formAction = '/messages/compose?senderID=' + employeeID;
                    $("#composeForm").attr("action", formAction);
                },
                error: function(error) {
                    console.log(error);
                }
            });
        });
    });

</script>


</body>
</html>
